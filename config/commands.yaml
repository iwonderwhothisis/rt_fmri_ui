# Neuro-Orch Command Configuration
# This file maps buttons and actions to bash commands

# System initialization commands
# These run when "Start Murfi" or "Start PsychoPy" buttons are clicked
systems:
  murfi:
    name: "Murfi"
    description: "Real-time fMRI processing system"
    startCommand: "echo 'Starting Murfi...' && sleep 1 && echo 'Murfi ready'"

  psychopy:
    name: "PsychoPy"
    description: "Task presentation system"
    startCommand: "psychopy"

# Step execution order - defines the order steps appear in the UI
# Only steps listed here will be available in the execution queue
# Categories are automatically derived from each step's "terminal" field
stepOrder:
  - '2vol'
  - 'resting_state'
  - 'extract_rs_networks'
  - 'process_roi_masks'
  - 'register'
  - 'feedback_no_15'
  - 'feedback_no_30'
  - 'feedback_yes_15'
  - 'feedback_yes_30'
  - 'cleanup'

# Session step commands
# These run when steps are executed from the queue
# terminal: which terminal to run the command in (murfi or psychopy)
# command: the bash command to execute
#
# Available variables for command substitution:
#   ${participantId}      - Participant identifier (e.g., "remind0001")
#   ${sessionDate}        - Session date in YYYY-MM-DD format
#   ${protocol}           - Protocol name (e.g., "DMN-NFB")
#   ${runNumber}          - Auto-incremented feedback run number (1, 2, 3...)
#   ${displayFeedback}    - "Feedback" or "No Feedback"
#   ${participantAnchor}  - Free text anchor value entered by user
#   ${feedbackCondition}  - Duration: "5min", "10min", "15min", "20min", or "30min"
steps:
  create:
    name: "Create Participant"
    terminal: "murfi"
    command: "echo 'Creating participant: ${participantId}'"

  setup:
    name: "Setup Session"
    terminal: "murfi"
    command: "echo 'Running setup...'"

  2vol:
    name: "2 Volume Calibration"
    terminal: "murfi"
    command: "echo 'Running 2vol calibration...'"

  resting_state:
    name: "Resting State"
    terminal: "murfi"
    command: "echo 'Running resting state scan...'"

  extract_rs_networks:
    name: "Extract RS Networks"
    terminal: "murfi"
    command: "echo 'Extracting resting state networks...'"

  process_roi_masks:
    name: "Process ROI Masks"
    terminal: "murfi"
    command: "echo 'Processing ROI masks...'"

  register:
    name: "Registration"
    terminal: "murfi"
    command: "echo 'Running registration...'"

  feedback_no_15:
    name: "No Feedback (15 min)"
    terminal: "psychopy"
    command: "echo 'Running feedback session: participant=${participantId} run=${runNumber} feedback=${displayFeedback} condition=${feedbackCondition} anchor=${participantAnchor}'"
    murfi_command: "echo 'Starting murfi feedback for ${participantId}'"

  feedback_no_30:
    name: "No Feedback (30 min)"
    terminal: "psychopy"
    command: "echo 'Running feedback session: participant=${participantId} run=${runNumber} feedback=${displayFeedback} condition=${feedbackCondition} anchor=${participantAnchor}'"
    murfi_command: "echo 'Starting murfi feedback for ${participantId}'"

  feedback_yes_15:
    name: "Feedback (15 min)"
    terminal: "psychopy"
    command: "echo 'Running feedback session: participant=${participantId} run=${runNumber} feedback=${displayFeedback} condition=${feedbackCondition} anchor=${participantAnchor}'"
    murfi_command: "echo 'Starting murfi feedback for ${participantId}'"

  feedback_yes_30:
    name: "Feedback (30 min)"
    terminal: "psychopy"
    command: "echo 'Running feedback session: participant=${participantId} run=${runNumber} feedback=${displayFeedback} condition=${feedbackCondition} anchor=${participantAnchor}'"
    murfi_command: "echo 'Starting murfi feedback for ${participantId}'"

  cleanup:
    name: "Cleanup"
    terminal: "murfi"
    command: "echo 'Running cleanup...'"

# Additional custom actions (optional)
actions:
  stopAll:
    name: "Stop All Processes"
    terminals:
      - murfi
      - psychopy
    command: "echo 'Stopping...'"

# Default behavior for buttons not explicitly configured
defaults:
  button:
    terminal: murfi
    command: "echo 'Button ${buttonId} pressed'"

# Button command configuration
# Each button can have an optional command that runs IN ADDITION to its default behavior
# terminal: murfi (default) or psychopy
# command: bash command to execute (supports ${variable} substitution)
buttons:
  # Initialize Step buttons
  initialize.startMurfi:
    terminal: murfi
    command: "echo 'Starting Murfi system...'"

  initialize.startPsychoPy:
    terminal: psychopy
    command: "echo 'Starting PsychoPy system...'"

  initialize.proceed:
    terminal: murfi
    command: "echo 'Proceeding to participant selection'"

  # Participant Selector buttons
  participant.addNew:
    terminal: murfi
    command: "echo 'Opening new participant form'"

  participant.create:
    terminal: murfi
    command: "echo 'Creating participant: ${participantId}'"

  participant.cancel:
    terminal: murfi
    command: "echo 'Cancelled participant creation'"

  participant.select:
    terminal: murfi
    command: "echo 'Selected participant: ${participantId}'"

  # RunScan buttons
  runScan.setup:
    terminal: murfi
    command: "echo 'Running setup for participant ${participantId}'"

  runScan.toggleTerminal:
    terminal: murfi
    command: "echo 'Terminal panel toggled'"

  # Session Controls buttons
  session.start:
    terminal: murfi
    command: "echo 'Starting session for participant ${participantId}'"

  session.reset:
    terminal: murfi
    command: "echo 'Session reset'"

  session.startQueue:
    terminal: murfi
    command: "echo 'Starting execution queue'"

  session.resume:
    terminal: murfi
    command: "echo 'Resuming execution queue'"

  session.stop:
    terminals:
      - murfi
      - psychopy
    command: "echo 'STOP signal sent'"

  session.clear:
    terminal: murfi
    command: "echo 'Queue cleared'"

  session.finish:
    terminal: murfi
    command: "echo 'Session completed'"

  # Queue Item buttons
  queue.remove:
    terminal: murfi
    command: "echo 'Removed ${stepName} from queue'"

  # Step Pipeline buttons
  stepPipeline.toggleHistory:
    terminal: murfi
    command: "echo 'Toggled execution history'"

  # Workflow Stepper buttons
  workflow.stepClick:
    terminal: murfi
    command: "echo 'Navigated to workflow step: ${stepId}'"

  # Session Card buttons
  sessionCard.viewDetails:
    terminal: murfi
    command: "echo 'Viewing session details: ${sessionId}'"

  # Session Detail buttons
  sessionDetail.back:
    terminal: murfi
    command: "echo 'Navigating back'"


  # Navigation buttons
  nav.runScan:
    terminal: murfi
    command: "echo 'Navigated to Run Scan'"

  nav.help:
    terminal: murfi
    command: "echo 'Help requested'"

  # Session Card buttons
  sessionCard.click:
    terminal: murfi
    command: "echo 'Clicked session card: ${sessionId}'"

  sessionCard.select:
    terminal: murfi
    command: "echo 'Session ${sessionId} selection changed to: ${selected}'"
